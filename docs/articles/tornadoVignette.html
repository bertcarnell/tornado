<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tornado and Importance Plots • tornado</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Tornado and Importance Plots">
<meta property="og:description" content="tornado">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tornado</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/tornadoVignette.html">Tornado and Importance Plots</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/bertcarnell/tornado/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Tornado and Importance Plots</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/bertcarnell/tornado/blob/HEAD/vignettes/tornadoVignette.Rmd" class="external-link"><code>vignettes/tornadoVignette.Rmd</code></a></small>
      <div class="hidden name"><code>tornadoVignette.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>A tornado plot is a visualization of the range of outputs expected
from a variety of inputs, or alternatively, the sensitivity of the
output to the range of inputs. Tornado plots have a number of
features:</p>
<ul>
<li>The center of the tornado is plotted at the response expected from
the mean of each input variable.<br>
</li>
<li>For a given variable, the width of the tornado is determined by the
response to a change in each input variable while holding all others
constant at their mean. Various criteria are used depending on the
specifics of the analysis. Three primary criteria are implemented in
this package:
<ul>
<li>The range of the variable. The input is set at the maximum, minimum,
and mean.</li>
<li>A multiplicative factor of the variable mean. The input is set at
<span class="math inline">\(100(1 - \alpha)\)</span>% and <span class="math inline">\(100(1+\alpha)\)</span>% of the mean.</li>
<li>A quantile of the variable’s distribution in the input data. The
input is set at <span class="math inline">\(100(1 - \alpha)\)</span>
percentile and <span class="math inline">\(100(1+\alpha)\)</span>
percentile</li>
</ul>
</li>
<li>Variables are ordered vertically with the widest bar at the top and
narrowest at the bottom.<br>
</li>
<li>Only one variable is moved from its mean value at a time.<br>
</li>
<li>Factors or categorical variables have also been added to these plots
by plotting dots at the resulting output as each factor is varied
through all of its levels.<br>
</li>
<li>The base factor level is chosen as the input variable for the center
of the tornado when factors are present.</li>
</ul>
<p>An importance plot attempts to dispay the relative impact of each
variable on the model fit. Traditionally, for linear models, the concept
of importance was expressed as the percentage of total response variable
variance that is explained by each variable, either alone, or in the
presence of the other variables in the model. Each model type can have
different measures of importance. In this package, the following methods
are used:</p>
<ul>
<li>Linear Models: percent of the total variance explained by each
variable alone and cumulatively with other variables in the model.</li>
<li>Generalized Linear Models: Same as linear models, but using the
deviance instead of the variance.</li>
<li>Survival Models, LASSO, Ridge Regression: The decrease in model Mean
Squared Error as each variable is permuted in the data set. Permuting a
varible in a data set remove the explanatory power of that variable
relative to the other vriables in the model still correlated with the
response variable.</li>
<li>
<code>caret</code> package models: The definition of variable
importance for each model in the <code>caret</code> package is taken
from the <code>varImp</code> method. See the <code>caret</code> package
for specifics.</li>
</ul>
</div>
<div class="section level2">
<h2 id="data-sets">Data Sets<a class="anchor" aria-label="anchor" href="#data-sets"></a>
</h2>
<p>A few standard data sets are used in these examples:</p>
<ul>
<li>
<code>mtcars</code>: Motor Trend Car Road Tests - predict Miles Per
Gallon (mpg) based on other car factors</li>
<li>
<code>mtcars_w_factors</code>: the <code>mtcars</code> dataset with
a few numeric variables replaced with categorical or factor variables
where appropriate. e.g. Automatic vs Manual transmission</li>
<li>
<code><a href="https://rdrr.io/pkg/survival/man/ovarian.html" class="external-link">survival::ovarian</a></code>: Ovarian Cancer Survival Data -
predict survival time</li>
<li>
<code><a href="https://rdrr.io/pkg/survival/man/bladder.html" class="external-link">survival::bladder</a></code>: Bladder Cancer recurrences - risk of
bladder cancer recurrence</li>
<li>
<code>iris</code>: Edgar Anderson’s Iris Data - predict the type of
iris from measurements</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mtcars_w_factors</span> <span class="op">&lt;-</span> <span class="va">mtcars</span></span>
<span><span class="co"># Automatic vs Manual</span></span>
<span><span class="va">mtcars_w_factors</span><span class="op">$</span><span class="va">am</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">am</span><span class="op">)</span></span>
<span><span class="co"># V or Straight cylinder arrangement</span></span>
<span><span class="va">mtcars_w_factors</span><span class="op">$</span><span class="va">vs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">vs</span><span class="op">)</span></span>
<span><span class="co"># number of cylinders</span></span>
<span><span class="va">mtcars_w_factors</span><span class="op">$</span><span class="va">cyl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">cyl</span><span class="op">)</span></span>
<span><span class="co"># number of forward gears</span></span>
<span><span class="va">mtcars_w_factors</span><span class="op">$</span><span class="va">gear</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">gear</span><span class="op">)</span></span>
<span><span class="co"># number of carburetors</span></span>
<span><span class="va">mtcars_w_factors</span><span class="op">$</span><span class="va">carb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">carb</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="tornado-plot-examples">Tornado Plot Examples<a class="anchor" aria-label="anchor" href="#tornado-plot-examples"></a>
</h2>
<div class="section level3">
<h3 id="lm">LM<a class="anchor" aria-label="anchor" href="#lm"></a>
</h3>
<div class="section level4">
<h4 id="type-percentchange">type = “PercentChange”<a class="anchor" aria-label="anchor" href="#type-percentchange"></a>
</h4>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lm1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">cyl</span><span class="op">*</span><span class="va">wt</span><span class="op">*</span><span class="va">hp</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span></span>
<span><span class="va">torn1</span> <span class="op">&lt;-</span> <span class="fu">tornado</span><span class="fu">::</span><span class="fu"><a href="../reference/tornado.html">tornado</a></span><span class="op">(</span><span class="va">lm1</span>, type <span class="op">=</span> <span class="st">"PercentChange"</span>, alpha <span class="op">=</span> <span class="fl">0.10</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">torn1</span>, xlabel <span class="op">=</span> <span class="st">"MPG"</span>, geom_bar_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="tornadoVignette_files/figure-html/lm1-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="type-rangess">type = “rangess”<a class="anchor" aria-label="anchor" href="#type-rangess"></a>
</h4>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">torn2</span> <span class="op">&lt;-</span> <span class="fu">tornado</span><span class="fu">::</span><span class="fu"><a href="../reference/tornado.html">tornado</a></span><span class="op">(</span><span class="va">lm1</span>, type <span class="op">=</span> <span class="st">"ranges"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">torn2</span>, xlabel <span class="op">=</span> <span class="st">"MPG"</span>, geom_bar_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="tornadoVignette_files/figure-html/lm2-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="type-percentiles">type = “percentiles”<a class="anchor" aria-label="anchor" href="#type-percentiles"></a>
</h4>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">torn3</span> <span class="op">&lt;-</span> <span class="fu">tornado</span><span class="fu">::</span><span class="fu"><a href="../reference/tornado.html">tornado</a></span><span class="op">(</span><span class="va">lm1</span>, type <span class="op">=</span> <span class="st">"percentiles"</span>, alpha <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">torn3</span>, xlabel <span class="op">=</span> <span class="st">"MPG"</span>, geom_bar_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="tornadoVignette_files/figure-html/lm3-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="including-categorical-variables">Including Categorical Variables<a class="anchor" aria-label="anchor" href="#including-categorical-variables"></a>
</h4>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lm4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">cyl</span> <span class="op">+</span> <span class="va">wt</span> <span class="op">+</span> <span class="va">hp</span> <span class="op">+</span> <span class="va">vs</span>, data <span class="op">=</span> <span class="va">mtcars_w_factors</span><span class="op">)</span></span>
<span><span class="va">torn4</span> <span class="op">&lt;-</span> <span class="fu">tornado</span><span class="fu">::</span><span class="fu"><a href="../reference/tornado.html">tornado</a></span><span class="op">(</span><span class="va">lm4</span>, type <span class="op">=</span> <span class="st">"percentiles"</span>, alpha <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">torn4</span>, xlabel <span class="op">=</span> <span class="st">"MPG"</span>, geom_bar_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="tornadoVignette_files/figure-html/lm4-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="changing-variable-names">Changing Variable Names<a class="anchor" aria-label="anchor" href="#changing-variable-names"></a>
</h4>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>old <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cyl"</span>, <span class="st">"wt"</span>, <span class="st">"hp"</span>, <span class="st">"vs"</span><span class="op">)</span>,</span>
<span>             new <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Cylinders"</span>, <span class="st">"Weight"</span>, <span class="st">"Horsepower"</span>, <span class="st">"V_or_Straight"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">torn5</span> <span class="op">&lt;-</span> <span class="fu">tornado</span><span class="fu">::</span><span class="fu"><a href="../reference/tornado.html">tornado</a></span><span class="op">(</span><span class="va">lm4</span>, type <span class="op">=</span> <span class="st">"percentiles"</span>, alpha <span class="op">=</span> <span class="fl">0.05</span>, dict <span class="op">=</span> <span class="va">dict</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">torn5</span>, xlabel <span class="op">=</span> <span class="st">"MPG"</span>, geom_bar_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="tornadoVignette_files/figure-html/lm5-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="plotting-options">Plotting Options<a class="anchor" aria-label="anchor" href="#plotting-options"></a>
</h4>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>old <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cyl"</span>, <span class="st">"wt"</span>, <span class="st">"hp"</span>, <span class="st">"vs"</span><span class="op">)</span>,</span>
<span>             new <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Cylinders"</span>, <span class="st">"Weight"</span>, <span class="st">"Horsepower"</span>, <span class="st">"V_or_Straight"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">torn5</span> <span class="op">&lt;-</span> <span class="fu">tornado</span><span class="fu">::</span><span class="fu"><a href="../reference/tornado.html">tornado</a></span><span class="op">(</span><span class="va">lm4</span>, type <span class="op">=</span> <span class="st">"percentiles"</span>, alpha <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">torn5</span>, xlabel <span class="op">=</span> <span class="st">"MPG"</span>, geom_bar_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span>,</span>
<span>     sensitivity_colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#FC8D62"</span>, <span class="st">"#66C2A5"</span><span class="op">)</span>,</span>
<span>     geom_point_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span>, fill <span class="op">=</span> <span class="st">"purple"</span>, col <span class="op">=</span> <span class="st">"purple"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="tornadoVignette_files/figure-html/lm6-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="extending-the-ggplot">Extending the ggplot<a class="anchor" aria-label="anchor" href="#extending-the-ggplot"></a>
</h4>
<p>Notes:</p>
<ul>
<li>The plot center is at 0 and the x-axis is relabeled. So Adding lines
to the plot should use a zero centered coordinate system</li>
<li>Also, the plot is drawn using coord_flip, so the horizonal line
below is draw vertically</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">torn5</span>, plot <span class="op">=</span> <span class="cn">FALSE</span>, xlabel <span class="op">=</span> <span class="st">"MPG"</span>, geom_bar_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span>,</span>
<span>          sensitivity_colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#FC8D62"</span>, <span class="st">"#66C2A5"</span><span class="op">)</span>,</span>
<span>          geom_point_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span>, fill <span class="op">=</span> <span class="st">"purple"</span>, col <span class="op">=</span> <span class="st">"purple"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="va">g</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Test Plot"</span><span class="op">)</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="va">g</span> <span class="op">+</span> <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span></span></code></pre></div>
<p><img src="tornadoVignette_files/figure-html/lm7-1.png" width="672"></p>
</div>
</div>
<div class="section level3">
<h3 id="glm">GLM<a class="anchor" aria-label="anchor" href="#glm"></a>
</h3>
<p>Predict if an engine is a V or Straight given covariates</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">glm1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">vs</span> <span class="op">~</span> <span class="va">wt</span> <span class="op">+</span> <span class="va">disp</span> <span class="op">+</span> <span class="va">cyl</span>, data <span class="op">=</span> <span class="va">mtcars</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">torn1</span> <span class="op">&lt;-</span> <span class="fu">tornado</span><span class="fu">::</span><span class="fu"><a href="../reference/tornado.html">tornado</a></span><span class="op">(</span><span class="va">glm1</span>, type <span class="op">=</span> <span class="st">"ranges"</span>, alpha <span class="op">=</span> <span class="fl">0.10</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">torn1</span>, xlabel <span class="op">=</span> <span class="st">"V or Straight Engine"</span>, geom_bar_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="tornadoVignette_files/figure-html/glm1-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="censored-data">Censored Data<a class="anchor" aria-label="anchor" href="#censored-data"></a>
</h3>
<div class="section level4">
<h4 id="surival-regression-or-accelerated-failure">Surival Regression or Accelerated Failure<a class="anchor" aria-label="anchor" href="#surival-regression-or-accelerated-failure"></a>
</h4>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">survreg1</span> <span class="op">&lt;-</span> <span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/survreg.html" class="external-link">survreg</a></span><span class="op">(</span><span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">futime</span>, <span class="va">fustat</span><span class="op">)</span> <span class="op">~</span> <span class="va">ecog.ps</span> <span class="op">+</span> <span class="va">rx</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">resid.ds</span>, </span>
<span>                              <span class="fu">survival</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/survival/man/ovarian.html" class="external-link">ovarian</a></span>, dist <span class="op">=</span> <span class="st">'weibull'</span>, scale <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">torn1</span> <span class="op">&lt;-</span> <span class="fu">tornado</span><span class="fu">::</span><span class="fu"><a href="../reference/tornado.html">tornado</a></span><span class="op">(</span><span class="va">survreg1</span>, modeldata <span class="op">=</span> <span class="fu">survival</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/survival/man/ovarian.html" class="external-link">ovarian</a></span>, </span>
<span>                          type <span class="op">=</span> <span class="st">"PercentChange"</span>, alpha <span class="op">=</span> <span class="fl">0.10</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">torn1</span>, xlabel <span class="op">=</span> <span class="st">"Survival Time"</span>, geom_bar_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="tornadoVignette_files/figure-html/censored1-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="cox-proportional-hazards">Cox Proportional Hazards<a class="anchor" aria-label="anchor" href="#cox-proportional-hazards"></a>
</h4>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coxph1</span> <span class="op">&lt;-</span> <span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">stop</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">rx</span> <span class="op">+</span> <span class="va">size</span> <span class="op">+</span> <span class="va">number</span>,</span>
<span>                          <span class="fu">survival</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/survival/man/bladder.html" class="external-link">bladder</a></span><span class="op">)</span></span>
<span><span class="va">torn1</span> <span class="op">&lt;-</span> <span class="fu">tornado</span><span class="fu">::</span><span class="fu"><a href="../reference/tornado.html">tornado</a></span><span class="op">(</span><span class="va">coxph1</span>, modeldata <span class="op">=</span> <span class="fu">survival</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/survival/man/bladder.html" class="external-link">bladder</a></span>, type <span class="op">=</span> <span class="st">"PercentChange"</span>,</span>
<span>                          alpha <span class="op">=</span> <span class="fl">0.10</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">torn1</span>, xlabel <span class="op">=</span> <span class="st">"Risk"</span>, geom_bar_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="tornadoVignette_files/figure-html/censored2-1.png" width="672"></p>
</div>
</div>
<div class="section level3">
<h3 id="ridge-regression-and-lasso">Ridge Regression and LASSO<a class="anchor" aria-label="anchor" href="#ridge-regression-and-lasso"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="va">has_glmnet</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">form</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">cyl</span><span class="op">*</span><span class="va">wt</span><span class="op">*</span><span class="va">hp</span><span class="op">)</span></span>
<span>  <span class="va">mf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.frame.html" class="external-link">model.frame</a></span><span class="op">(</span><span class="va">form</span>, data<span class="op">=</span><span class="va">mtcars</span><span class="op">)</span></span>
<span>  <span class="va">mm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="va">form</span>, <span class="va">mf</span><span class="op">)</span></span>
<span>  <span class="va">gtest</span> <span class="op">&lt;-</span> <span class="fu">glmnet</span><span class="fu">::</span><span class="fu"><a href="https://glmnet.stanford.edu/reference/cv.glmnet.html" class="external-link">cv.glmnet</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mm</span>, y <span class="op">=</span> <span class="va">mtcars</span><span class="op">$</span><span class="va">mpg</span>, family <span class="op">=</span> <span class="st">"gaussian"</span><span class="op">)</span></span>
<span>  <span class="va">torn</span> <span class="op">&lt;-</span> <span class="fu">tornado</span><span class="fu">::</span><span class="fu"><a href="../reference/tornado.html">tornado</a></span><span class="op">(</span><span class="va">gtest</span>, modeldata <span class="op">=</span> <span class="va">mtcars</span>, </span>
<span>                           form <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">cyl</span><span class="op">*</span><span class="va">wt</span><span class="op">*</span><span class="va">hp</span><span class="op">)</span>, </span>
<span>                           s <span class="op">=</span> <span class="st">"lambda.1se"</span>,</span>
<span>                           type <span class="op">=</span> <span class="st">"PercentChange"</span>, alpha <span class="op">=</span> <span class="fl">0.10</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">torn</span>, xlabel <span class="op">=</span> <span class="st">"MPG"</span>, geom_bar_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span></span>
<span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"glmnet is not available for vignette rendering"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="tornadoVignette_files/figure-html/glmnet1-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="machine-learning-models">Machine Learning Models<a class="anchor" aria-label="anchor" href="#machine-learning-models"></a>
</h3>
<div class="section level4">
<h4 id="regression">Regression<a class="anchor" aria-label="anchor" href="#regression"></a>
</h4>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="va">has_caret</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">gtest</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">train</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">mtcars_w_factors</span>, select <span class="op">=</span> <span class="op">-</span><span class="va">mpg</span><span class="op">)</span>, </span>
<span>                        y <span class="op">=</span> <span class="va">mtcars_w_factors</span><span class="op">$</span><span class="va">mpg</span>, method <span class="op">=</span> <span class="st">"rf"</span><span class="op">)</span></span>
<span>  <span class="va">torn</span> <span class="op">&lt;-</span> <span class="fu">tornado</span><span class="fu">::</span><span class="fu"><a href="../reference/tornado.html">tornado</a></span><span class="op">(</span><span class="va">gtest</span>, type <span class="op">=</span> <span class="st">"percentiles"</span>, alpha <span class="op">=</span> <span class="fl">0.10</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">torn</span>, xlabel <span class="op">=</span> <span class="st">"MPG"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span></span>
<span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"caret is not available for vignette rendering"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Loading required package: lattice</span></span></code></pre></div>
<p><img src="tornadoVignette_files/figure-html/train_regression-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="classification">Classification<a class="anchor" aria-label="anchor" href="#classification"></a>
</h4>
<p>The <code>plot</code> method can also return a ggplot object</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="va">has_caret</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">gtest</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">train</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">iris</span>, select <span class="op">=</span> <span class="op">-</span><span class="va">Species</span><span class="op">)</span>, </span>
<span>                        y <span class="op">=</span> <span class="va">iris</span><span class="op">$</span><span class="va">Species</span>, method <span class="op">=</span> <span class="st">"rf"</span><span class="op">)</span></span>
<span>  <span class="va">torn</span> <span class="op">&lt;-</span> <span class="fu">tornado</span><span class="fu">::</span><span class="fu"><a href="../reference/tornado.html">tornado</a></span><span class="op">(</span><span class="va">gtest</span>, type <span class="op">=</span> <span class="st">"percentiles"</span>, alpha <span class="op">=</span> <span class="fl">0.10</span>, class_number <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">torn</span>, plot <span class="op">=</span> <span class="cn">FALSE</span>, xlabel <span class="op">=</span> <span class="st">"Probability of the Setosa Species"</span><span class="op">)</span></span>
<span>  <span class="va">g</span> <span class="op">&lt;-</span> <span class="va">g</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Classifier caret::train 'rf', 10th to 90th perc. of each var."</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">torn</span> <span class="op">&lt;-</span> <span class="fu">tornado</span><span class="fu">::</span><span class="fu"><a href="../reference/tornado.html">tornado</a></span><span class="op">(</span><span class="va">gtest</span>, type <span class="op">=</span> <span class="st">"percentiles"</span>, alpha <span class="op">=</span> <span class="fl">0.10</span>, class_number <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">torn</span>, plot <span class="op">=</span> <span class="cn">FALSE</span>, xlabel <span class="op">=</span> <span class="st">"Probability of the versicolor Species"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span></span>
<span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"caret is not available for vignette rendering"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="tornadoVignette_files/figure-html/train_section-1.png" width="672"><img src="tornadoVignette_files/figure-html/train_section-2.png" width="672"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="importance-plots">Importance Plots<a class="anchor" aria-label="anchor" href="#importance-plots"></a>
</h2>
<div class="section level3">
<h3 id="linear-models">Linear Models<a class="anchor" aria-label="anchor" href="#linear-models"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gtest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">cyl</span><span class="op">*</span><span class="va">wt</span><span class="op">*</span><span class="va">hp</span> <span class="op">+</span> <span class="va">gear</span> <span class="op">+</span> <span class="va">carb</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span></span>
<span><span class="va">gtestreduced</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span></span>
<span><span class="va">imp</span> <span class="op">&lt;-</span> <span class="fu">tornado</span><span class="fu">::</span><span class="fu"><a href="../reference/importance.html">importance</a></span><span class="op">(</span><span class="va">gtest</span>, <span class="va">gtestreduced</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">imp</span><span class="op">)</span></span></code></pre></div>
<p><img src="tornadoVignette_files/figure-html/imp.lm-1.png" width="672"></p>
<div class="section level4">
<h4 id="using-a-dictionary-to-translate-the-variable-names-and-chaning-colors">Using a dictionary to translate the variable names and chaning
colors<a class="anchor" aria-label="anchor" href="#using-a-dictionary-to-translate-the-variable-names-and-chaning-colors"></a>
</h4>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>old <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cyl"</span>, <span class="st">"wt"</span>, <span class="st">"hp"</span>, <span class="st">"vs"</span>, <span class="st">"gear"</span>, <span class="st">"carb"</span><span class="op">)</span>,</span>
<span>             new <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Cylinders"</span>, <span class="st">"Weight"</span>, <span class="st">"Horsepower"</span>, <span class="st">"V_or_Straight"</span>, <span class="st">"Num Gears"</span>, <span class="st">"Num Carbs"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">imp</span> <span class="op">&lt;-</span> <span class="fu">tornado</span><span class="fu">::</span><span class="fu"><a href="../reference/importance.html">importance</a></span><span class="op">(</span><span class="va">gtest</span>, <span class="va">gtestreduced</span>, dict <span class="op">=</span> <span class="va">dict</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">imp</span>, col_importance_alone <span class="op">=</span> <span class="st">"#8DD3C7"</span>, </span>
<span>     col_importance_cumulative <span class="op">=</span> <span class="st">"#FFFFB3"</span><span class="op">)</span></span></code></pre></div>
<p><img src="tornadoVignette_files/figure-html/imp.lm.dict-1.png" width="672"></p>
</div>
</div>
<div class="section level3">
<h3 id="generalized-linear-models">Generalized Linear Models<a class="anchor" aria-label="anchor" href="#generalized-linear-models"></a>
</h3>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gtest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">vs</span> <span class="op">~</span> <span class="va">wt</span> <span class="op">+</span> <span class="va">disp</span> <span class="op">+</span> <span class="va">gear</span>, data <span class="op">=</span> <span class="va">mtcars</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">gtestreduced</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">vs</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">mtcars</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">imp</span> <span class="op">&lt;-</span> <span class="fu">tornado</span><span class="fu">::</span><span class="fu"><a href="../reference/importance.html">importance</a></span><span class="op">(</span><span class="va">gtest</span>, <span class="va">gtestreduced</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">imp</span><span class="op">)</span></span></code></pre></div>
<p><img src="tornadoVignette_files/figure-html/imp.glm-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="censored-data-1">Censored Data<a class="anchor" aria-label="anchor" href="#censored-data-1"></a>
</h3>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_final</span> <span class="op">&lt;-</span> <span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/survreg.html" class="external-link">survreg</a></span><span class="op">(</span><span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">futime</span>, <span class="va">fustat</span><span class="op">)</span> <span class="op">~</span> <span class="va">ecog.ps</span><span class="op">*</span><span class="va">rx</span> <span class="op">+</span> <span class="va">age</span>,</span>
<span>                                 data <span class="op">=</span> <span class="fu">survival</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/survival/man/ovarian.html" class="external-link">ovarian</a></span>,</span>
<span>                                 dist <span class="op">=</span> <span class="st">"weibull"</span><span class="op">)</span></span>
<span><span class="va">imp</span> <span class="op">&lt;-</span> <span class="fu">tornado</span><span class="fu">::</span><span class="fu"><a href="../reference/importance.html">importance</a></span><span class="op">(</span><span class="va">model_final</span>, <span class="fu">survival</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/survival/man/ovarian.html" class="external-link">ovarian</a></span>, nperm <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">imp</span>, geom_bar_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.4</span>, fill <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="tornadoVignette_files/figure-html/imp_survreg-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="machine-learning">Machine Learning<a class="anchor" aria-label="anchor" href="#machine-learning"></a>
</h3>
<div class="section level4">
<h4 id="regression-1">Regression<a class="anchor" aria-label="anchor" href="#regression-1"></a>
</h4>
<p>The number of variables plotted can also be controlled</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="va">has_caret</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">gtest</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">train</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">mtcars_w_factors</span>, select <span class="op">=</span> <span class="op">-</span><span class="va">mpg</span><span class="op">)</span>, </span>
<span>                        y <span class="op">=</span> <span class="va">mtcars_w_factors</span><span class="op">$</span><span class="va">mpg</span>, method <span class="op">=</span> <span class="st">"rf"</span><span class="op">)</span></span>
<span>  <span class="va">imp</span> <span class="op">&lt;-</span> <span class="fu">tornado</span><span class="fu">::</span><span class="fu"><a href="../reference/importance.html">importance</a></span><span class="op">(</span><span class="va">gtest</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">imp</span>, nvar <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span></span>
<span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"caret is not available for vignette rendering"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="tornadoVignette_files/figure-html/train.regression.imp-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="classification-1">Classification<a class="anchor" aria-label="anchor" href="#classification-1"></a>
</h4>
<p>The <code>plot</code> method can also return a ggplot object</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="va">has_caret</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">gtest</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">train</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">iris</span>, select <span class="op">=</span> <span class="op">-</span><span class="va">Species</span><span class="op">)</span>, </span>
<span>                        y <span class="op">=</span> <span class="va">iris</span><span class="op">$</span><span class="va">Species</span>, method <span class="op">=</span> <span class="st">"rf"</span><span class="op">)</span></span>
<span>  <span class="va">imp</span> <span class="op">&lt;-</span> <span class="fu">tornado</span><span class="fu">::</span><span class="fu"><a href="../reference/importance.html">importance</a></span><span class="op">(</span><span class="va">gtest</span><span class="op">)</span></span>
<span>  <span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">imp</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">g</span> <span class="op">&lt;-</span> <span class="va">g</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Classifier caret::train randomforest: variable importance"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span></span>
<span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"caret is not available for vignette rendering"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="tornadoVignette_files/figure-html/train.classification.imp-1.png" width="672"></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Rob Carnell.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
