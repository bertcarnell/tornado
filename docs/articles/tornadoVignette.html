<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Tornado and Importance Plots • tornado</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Tornado and Importance Plots">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tornado</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/tornadoVignette.html">Tornado and Importance Plots</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bertcarnell/tornado/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Tornado and Importance Plots</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/bertcarnell/tornado/blob/v0.2.0/vignettes/tornadoVignette.Rmd" class="external-link"><code>vignettes/tornadoVignette.Rmd</code></a></small>
      <div class="d-none name"><code>tornadoVignette.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>A tornado plot is a visualization of the range of outputs expected
from a variety of inputs, or alternatively, the sensitivity of the
output to the range of inputs. Tornado plots have a number of
features:</p>
<ul>
<li>The center of the tornado is plotted at the response expected from
the mean of each input variable.<br>
</li>
<li>For a given variable, the width of the tornado is determined by the
response to a change in each input variable while holding all others
constant at their mean. Various criteria are used depending on the
specifics of the analysis. Three primary criteria are implemented in
this package:
<ul>
<li>The range of the variable. The input is set at the maximum, minimum,
and mean.</li>
<li>A multiplicative factor of the variable mean. The input is set at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>100</mn><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>α</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">100(1 - \alpha)</annotation></semantics></math>%
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>100</mn><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>+</mo><mi>α</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">100(1+\alpha)</annotation></semantics></math>%
of the mean.</li>
<li>A quantile of the variable’s distribution in the input data. The
input is set at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>100</mn><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>α</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">100(1 - \alpha)</annotation></semantics></math>
percentile and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>100</mn><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>+</mo><mi>α</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">100(1+\alpha)</annotation></semantics></math>
percentile</li>
</ul>
</li>
<li>Variables are ordered vertically with the widest bar at the top and
narrowest at the bottom.<br>
</li>
<li>Only one variable is moved from its mean value at a time.<br>
</li>
<li>Factors or categorical variables have also been added to these plots
by plotting dots at the resulting output as each factor is varied
through all of its levels.<br>
</li>
<li>The base factor level is chosen as the input variable for the center
of the tornado when factors are present.</li>
</ul>
<p>An importance plot attempts to display the relative impact of each
variable on the model fit. Traditionally, for linear models, the concept
of importance was expressed as the percentage of total response variable
variance that is explained by each variable, either alone, or in the
presence of the other variables in the model. Each model type can have
different measures of importance. In this package, the following methods
are used:</p>
<ul>
<li>
<strong>Linear Models</strong>: percent of the total variance
explained by each variable alone and cumulatively with other variables
in the model.</li>
<li>
<strong>Generalized Linear Models</strong>: Same as linear models,
but using the deviance instead of the variance.</li>
<li>
<strong>Survival Models</strong>, <strong>LASSO</strong>,
<strong>Ridge Regression</strong>: The decrease in model Mean Squared
Error as each variable is permuted in the data set. Permuting a variable
in a data set remove the explanatory power of that variable relative to
the other variables in the model still correlated with the response
variable.</li>
<li>
<code>caret</code> package models: The definition of variable
importance for each model in the <code>caret</code> package is taken
from the <code>varImp</code> method. See the <code>caret</code> package
for specifics.</li>
</ul>
</div>
<div class="section level2">
<h2 id="data-sets">Data Sets<a class="anchor" aria-label="anchor" href="#data-sets"></a>
</h2>
<p>A few standard data sets are used in these examples:</p>
<ul>
<li>
<code>mtcars</code>: Motor Trend Car Road Tests - predict Miles Per
Gallon (mpg) based on other car factors</li>
<li>
<code>mtcars_w_factors</code>: the <code>mtcars</code> dataset with
a few numeric variables replaced with categorical or factor variables
where appropriate. e.g. Automatic vs Manual transmission</li>
<li>
<code><a href="https://rdrr.io/pkg/survival/man/ovarian.html" class="external-link">survival::ovarian</a></code>: Ovarian Cancer Survival Data -
predict survival time</li>
<li>
<code><a href="https://rdrr.io/pkg/survival/man/bladder.html" class="external-link">survival::bladder</a></code>: Bladder Cancer recurrences - risk of
bladder cancer recurrence</li>
<li>
<code>iris</code>: Edgar Anderson’s Iris Data - predict the type of
iris from measurements</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mtcars_w_factors</span> <span class="op">&lt;-</span> <span class="va">mtcars</span></span>
<span><span class="co"># Automatic vs Manual</span></span>
<span><span class="va">mtcars_w_factors</span><span class="op">$</span><span class="va">am</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">am</span><span class="op">)</span></span>
<span><span class="co"># V or Straight cylinder arrangement</span></span>
<span><span class="va">mtcars_w_factors</span><span class="op">$</span><span class="va">vs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">vs</span><span class="op">)</span></span>
<span><span class="co"># number of cylinders</span></span>
<span><span class="va">mtcars_w_factors</span><span class="op">$</span><span class="va">cyl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">cyl</span><span class="op">)</span></span>
<span><span class="co"># number of forward gears</span></span>
<span><span class="va">mtcars_w_factors</span><span class="op">$</span><span class="va">gear</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">gear</span><span class="op">)</span></span>
<span><span class="co"># number of carburetors</span></span>
<span><span class="va">mtcars_w_factors</span><span class="op">$</span><span class="va">carb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">carb</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="tornado-plot-examples">Tornado Plot Examples<a class="anchor" aria-label="anchor" href="#tornado-plot-examples"></a>
</h2>
<div class="section level3">
<h3 id="lm">LM<a class="anchor" aria-label="anchor" href="#lm"></a>
</h3>
<div class="section level4">
<h4 id="type-percentchange">type = “PercentChange”<a class="anchor" aria-label="anchor" href="#type-percentchange"></a>
</h4>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lm1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">cyl</span><span class="op">*</span><span class="va">wt</span><span class="op">*</span><span class="va">hp</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span></span>
<span><span class="va">torn1</span> <span class="op">&lt;-</span> <span class="fu">tornado</span><span class="fu">::</span><span class="fu"><a href="../reference/tornado.html">tornado</a></span><span class="op">(</span><span class="va">lm1</span>, type <span class="op">=</span> <span class="st">"PercentChange"</span>, alpha <span class="op">=</span> <span class="fl">0.10</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">torn1</span>, xlabel <span class="op">=</span> <span class="st">"MPG"</span>, geom_bar_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="tornadoVignette_files/figure-html/lm1-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="type-rangess">type = “rangess”<a class="anchor" aria-label="anchor" href="#type-rangess"></a>
</h4>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">torn2</span> <span class="op">&lt;-</span> <span class="fu">tornado</span><span class="fu">::</span><span class="fu"><a href="../reference/tornado.html">tornado</a></span><span class="op">(</span><span class="va">lm1</span>, type <span class="op">=</span> <span class="st">"ranges"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">torn2</span>, xlabel <span class="op">=</span> <span class="st">"MPG"</span>, geom_bar_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="tornadoVignette_files/figure-html/lm2-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="type-percentiles">type = “percentiles”<a class="anchor" aria-label="anchor" href="#type-percentiles"></a>
</h4>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">torn3</span> <span class="op">&lt;-</span> <span class="fu">tornado</span><span class="fu">::</span><span class="fu"><a href="../reference/tornado.html">tornado</a></span><span class="op">(</span><span class="va">lm1</span>, type <span class="op">=</span> <span class="st">"percentiles"</span>, alpha <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">torn3</span>, xlabel <span class="op">=</span> <span class="st">"MPG"</span>, geom_bar_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="tornadoVignette_files/figure-html/lm3-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="including-categorical-variables">Including Categorical Variables<a class="anchor" aria-label="anchor" href="#including-categorical-variables"></a>
</h4>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lm4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">cyl</span> <span class="op">+</span> <span class="va">wt</span> <span class="op">+</span> <span class="va">hp</span> <span class="op">+</span> <span class="va">vs</span>, data <span class="op">=</span> <span class="va">mtcars_w_factors</span><span class="op">)</span></span>
<span><span class="va">torn4</span> <span class="op">&lt;-</span> <span class="fu">tornado</span><span class="fu">::</span><span class="fu"><a href="../reference/tornado.html">tornado</a></span><span class="op">(</span><span class="va">lm4</span>, type <span class="op">=</span> <span class="st">"percentiles"</span>, alpha <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">torn4</span>, xlabel <span class="op">=</span> <span class="st">"MPG"</span>, geom_bar_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="tornadoVignette_files/figure-html/lm4-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="changing-variable-names">Changing Variable Names<a class="anchor" aria-label="anchor" href="#changing-variable-names"></a>
</h4>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>old <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cyl"</span>, <span class="st">"wt"</span>, <span class="st">"hp"</span>, <span class="st">"vs"</span><span class="op">)</span>,</span>
<span>             new <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Cylinders"</span>, <span class="st">"Weight"</span>, <span class="st">"Horsepower"</span>, <span class="st">"V_or_Straight"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">torn5</span> <span class="op">&lt;-</span> <span class="fu">tornado</span><span class="fu">::</span><span class="fu"><a href="../reference/tornado.html">tornado</a></span><span class="op">(</span><span class="va">lm4</span>, type <span class="op">=</span> <span class="st">"percentiles"</span>, alpha <span class="op">=</span> <span class="fl">0.05</span>, dict <span class="op">=</span> <span class="va">dict</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">torn5</span>, xlabel <span class="op">=</span> <span class="st">"MPG"</span>, geom_bar_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="tornadoVignette_files/figure-html/lm5-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="plotting-options">Plotting Options<a class="anchor" aria-label="anchor" href="#plotting-options"></a>
</h4>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>old <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cyl"</span>, <span class="st">"wt"</span>, <span class="st">"hp"</span>, <span class="st">"vs"</span><span class="op">)</span>,</span>
<span>             new <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Cylinders"</span>, <span class="st">"Weight"</span>, <span class="st">"Horsepower"</span>, <span class="st">"V_or_Straight"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">torn5</span> <span class="op">&lt;-</span> <span class="fu">tornado</span><span class="fu">::</span><span class="fu"><a href="../reference/tornado.html">tornado</a></span><span class="op">(</span><span class="va">lm4</span>, type <span class="op">=</span> <span class="st">"percentiles"</span>, alpha <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">torn5</span>, xlabel <span class="op">=</span> <span class="st">"MPG"</span>, geom_bar_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span>,</span>
<span>     sensitivity_colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#FC8D62"</span>, <span class="st">"#66C2A5"</span><span class="op">)</span>,</span>
<span>     geom_point_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span>, fill <span class="op">=</span> <span class="st">"purple"</span>, col <span class="op">=</span> <span class="st">"purple"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="tornadoVignette_files/figure-html/lm6-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="extending-the-ggplot">Extending the ggplot<a class="anchor" aria-label="anchor" href="#extending-the-ggplot"></a>
</h4>
<p>Notes:</p>
<ul>
<li>The plot center is at 0 and the x-axis is relabeled. So Adding lines
to the plot should use a zero centered coordinate system</li>
<li>Also, the plot is drawn using coord_flip, so the horizonal line
below is draw vertically</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">torn5</span>, plot <span class="op">=</span> <span class="cn">FALSE</span>, xlabel <span class="op">=</span> <span class="st">"MPG"</span>, geom_bar_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span>,</span>
<span>          sensitivity_colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#FC8D62"</span>, <span class="st">"#66C2A5"</span><span class="op">)</span>,</span>
<span>          geom_point_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span>, fill <span class="op">=</span> <span class="st">"purple"</span>, col <span class="op">=</span> <span class="st">"purple"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="va">g</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Test Plot"</span><span class="op">)</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="va">g</span> <span class="op">+</span> <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span></span></code></pre></div>
<p><img src="tornadoVignette_files/figure-html/lm7-1.png" width="672"></p>
</div>
</div>
<div class="section level3">
<h3 id="glm">GLM<a class="anchor" aria-label="anchor" href="#glm"></a>
</h3>
<p>Predict if an engine is a V or Straight given covariates</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">glm1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">vs</span> <span class="op">~</span> <span class="va">wt</span> <span class="op">+</span> <span class="va">disp</span> <span class="op">+</span> <span class="va">cyl</span>, data <span class="op">=</span> <span class="va">mtcars</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">torn1</span> <span class="op">&lt;-</span> <span class="fu">tornado</span><span class="fu">::</span><span class="fu"><a href="../reference/tornado.html">tornado</a></span><span class="op">(</span><span class="va">glm1</span>, type <span class="op">=</span> <span class="st">"ranges"</span>, alpha <span class="op">=</span> <span class="fl">0.10</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">torn1</span>, xlabel <span class="op">=</span> <span class="st">"V or Straight Engine"</span>, geom_bar_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="tornadoVignette_files/figure-html/glm1-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="censored-data">Censored Data<a class="anchor" aria-label="anchor" href="#censored-data"></a>
</h3>
<div class="section level4">
<h4 id="surival-regression-or-accelerated-failure">Surival Regression or Accelerated Failure<a class="anchor" aria-label="anchor" href="#surival-regression-or-accelerated-failure"></a>
</h4>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">survreg1</span> <span class="op">&lt;-</span> <span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/survreg.html" class="external-link">survreg</a></span><span class="op">(</span><span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">futime</span>, <span class="va">fustat</span><span class="op">)</span> <span class="op">~</span> <span class="va">ecog.ps</span> <span class="op">+</span> <span class="va">rx</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">resid.ds</span>, </span>
<span>                              <span class="fu">survival</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/survival/man/ovarian.html" class="external-link">ovarian</a></span>, dist <span class="op">=</span> <span class="st">'weibull'</span>, scale <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">torn1</span> <span class="op">&lt;-</span> <span class="fu">tornado</span><span class="fu">::</span><span class="fu"><a href="../reference/tornado.html">tornado</a></span><span class="op">(</span><span class="va">survreg1</span>, modeldata <span class="op">=</span> <span class="fu">survival</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/survival/man/ovarian.html" class="external-link">ovarian</a></span>, </span>
<span>                          type <span class="op">=</span> <span class="st">"PercentChange"</span>, alpha <span class="op">=</span> <span class="fl">0.10</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">torn1</span>, xlabel <span class="op">=</span> <span class="st">"Survival Time"</span>, geom_bar_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="tornadoVignette_files/figure-html/censored1-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="cox-proportional-hazards">Cox Proportional Hazards<a class="anchor" aria-label="anchor" href="#cox-proportional-hazards"></a>
</h4>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coxph1</span> <span class="op">&lt;-</span> <span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">stop</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">rx</span> <span class="op">+</span> <span class="va">size</span> <span class="op">+</span> <span class="va">number</span>,</span>
<span>                          <span class="fu">survival</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/survival/man/bladder.html" class="external-link">bladder</a></span><span class="op">)</span></span>
<span><span class="va">torn1</span> <span class="op">&lt;-</span> <span class="fu">tornado</span><span class="fu">::</span><span class="fu"><a href="../reference/tornado.html">tornado</a></span><span class="op">(</span><span class="va">coxph1</span>, modeldata <span class="op">=</span> <span class="fu">survival</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/survival/man/bladder.html" class="external-link">bladder</a></span>, type <span class="op">=</span> <span class="st">"PercentChange"</span>,</span>
<span>                          alpha <span class="op">=</span> <span class="fl">0.10</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">torn1</span>, xlabel <span class="op">=</span> <span class="st">"Risk"</span>, geom_bar_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="tornadoVignette_files/figure-html/censored2-1.png" width="672"></p>
</div>
</div>
<div class="section level3">
<h3 id="ridge-regression-and-lasso">Ridge Regression and LASSO<a class="anchor" aria-label="anchor" href="#ridge-regression-and-lasso"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"glmnet"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">form</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">cyl</span><span class="op">*</span><span class="va">wt</span><span class="op">*</span><span class="va">hp</span><span class="op">)</span></span>
<span>  <span class="va">mf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.frame.html" class="external-link">model.frame</a></span><span class="op">(</span><span class="va">form</span>, data<span class="op">=</span><span class="va">mtcars</span><span class="op">)</span></span>
<span>  <span class="va">mm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="va">form</span>, <span class="va">mf</span><span class="op">)</span></span>
<span>  <span class="va">gtest</span> <span class="op">&lt;-</span> <span class="fu">glmnet</span><span class="fu">::</span><span class="fu"><a href="https://glmnet.stanford.edu/reference/cv.glmnet.html" class="external-link">cv.glmnet</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mm</span>, y <span class="op">=</span> <span class="va">mtcars</span><span class="op">$</span><span class="va">mpg</span>, family <span class="op">=</span> <span class="st">"gaussian"</span><span class="op">)</span></span>
<span>  <span class="va">torn</span> <span class="op">&lt;-</span> <span class="fu">tornado</span><span class="fu">::</span><span class="fu"><a href="../reference/tornado.html">tornado</a></span><span class="op">(</span><span class="va">gtest</span>, modeldata <span class="op">=</span> <span class="va">mtcars</span>, </span>
<span>                           form <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">cyl</span><span class="op">*</span><span class="va">wt</span><span class="op">*</span><span class="va">hp</span><span class="op">)</span>, </span>
<span>                           s <span class="op">=</span> <span class="st">"lambda.1se"</span>,</span>
<span>                           type <span class="op">=</span> <span class="st">"PercentChange"</span>, alpha <span class="op">=</span> <span class="fl">0.10</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">torn</span>, xlabel <span class="op">=</span> <span class="st">"MPG"</span>, geom_bar_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span></span>
<span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"glmnet is not available for vignette rendering"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="tornadoVignette_files/figure-html/glmnet1-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="machine-learning-models">Machine Learning Models<a class="anchor" aria-label="anchor" href="#machine-learning-models"></a>
</h3>
<div class="section level4">
<h4 id="regression">Regression<a class="anchor" aria-label="anchor" href="#regression"></a>
</h4>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"caret"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">&amp;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"randomForest"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">gtest</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">train</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">mtcars_w_factors</span>, select <span class="op">=</span> <span class="op">-</span><span class="va">mpg</span><span class="op">)</span>, </span>
<span>                        y <span class="op">=</span> <span class="va">mtcars_w_factors</span><span class="op">$</span><span class="va">mpg</span>, method <span class="op">=</span> <span class="st">"rf"</span><span class="op">)</span></span>
<span>  <span class="va">torn</span> <span class="op">&lt;-</span> <span class="fu">tornado</span><span class="fu">::</span><span class="fu"><a href="../reference/tornado.html">tornado</a></span><span class="op">(</span><span class="va">gtest</span>, type <span class="op">=</span> <span class="st">"percentiles"</span>, alpha <span class="op">=</span> <span class="fl">0.10</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">torn</span>, xlabel <span class="op">=</span> <span class="st">"MPG"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span></span>
<span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"caret or randomForest is not available for vignette rendering"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Loading required package: lattice</span></span></code></pre></div>
<p><img src="tornadoVignette_files/figure-html/train_regression-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="classification">Classification<a class="anchor" aria-label="anchor" href="#classification"></a>
</h4>
<p>The <code>plot</code> method can also return a ggplot object</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"caret"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">&amp;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"randomForest"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">gtest</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">train</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">iris</span>, select <span class="op">=</span> <span class="op">-</span><span class="va">Species</span><span class="op">)</span>, </span>
<span>                        y <span class="op">=</span> <span class="va">iris</span><span class="op">$</span><span class="va">Species</span>, method <span class="op">=</span> <span class="st">"rf"</span><span class="op">)</span></span>
<span>  <span class="va">torn</span> <span class="op">&lt;-</span> <span class="fu">tornado</span><span class="fu">::</span><span class="fu"><a href="../reference/tornado.html">tornado</a></span><span class="op">(</span><span class="va">gtest</span>, type <span class="op">=</span> <span class="st">"percentiles"</span>, alpha <span class="op">=</span> <span class="fl">0.10</span>, class_number <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">torn</span>, plot <span class="op">=</span> <span class="cn">FALSE</span>, xlabel <span class="op">=</span> <span class="st">"Probability of the Setosa Species"</span><span class="op">)</span></span>
<span>  <span class="va">g</span> <span class="op">&lt;-</span> <span class="va">g</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Classifier caret::train 'rf', 10th to 90th perc. of each var."</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">torn</span> <span class="op">&lt;-</span> <span class="fu">tornado</span><span class="fu">::</span><span class="fu"><a href="../reference/tornado.html">tornado</a></span><span class="op">(</span><span class="va">gtest</span>, type <span class="op">=</span> <span class="st">"percentiles"</span>, alpha <span class="op">=</span> <span class="fl">0.10</span>, class_number <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">torn</span>, plot <span class="op">=</span> <span class="cn">FALSE</span>, xlabel <span class="op">=</span> <span class="st">"Probability of the versicolor Species"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span></span>
<span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"caret or randomForest is not available for vignette rendering"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="tornadoVignette_files/figure-html/train_section-1.png" width="672"><img src="tornadoVignette_files/figure-html/train_section-2.png" width="672"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="importance-plots">Importance Plots<a class="anchor" aria-label="anchor" href="#importance-plots"></a>
</h2>
<div class="section level3">
<h3 id="linear-models">Linear Models<a class="anchor" aria-label="anchor" href="#linear-models"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gtest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">cyl</span><span class="op">*</span><span class="va">wt</span><span class="op">*</span><span class="va">hp</span> <span class="op">+</span> <span class="va">gear</span> <span class="op">+</span> <span class="va">carb</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span></span>
<span><span class="va">gtestreduced</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span></span>
<span><span class="va">imp</span> <span class="op">&lt;-</span> <span class="fu">tornado</span><span class="fu">::</span><span class="fu"><a href="../reference/importance.html">importance</a></span><span class="op">(</span><span class="va">gtest</span>, <span class="va">gtestreduced</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">imp</span><span class="op">)</span></span></code></pre></div>
<p><img src="tornadoVignette_files/figure-html/imp.lm-1.png" width="672"></p>
<div class="section level4">
<h4 id="using-a-dictionary-to-translate-the-variable-names-and-chaning-colors">Using a dictionary to translate the variable names and chaning
colors<a class="anchor" aria-label="anchor" href="#using-a-dictionary-to-translate-the-variable-names-and-chaning-colors"></a>
</h4>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>old <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cyl"</span>, <span class="st">"wt"</span>, <span class="st">"hp"</span>, <span class="st">"vs"</span>, <span class="st">"gear"</span>, <span class="st">"carb"</span><span class="op">)</span>,</span>
<span>             new <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Cylinders"</span>, <span class="st">"Weight"</span>, <span class="st">"Horsepower"</span>, <span class="st">"V_or_Straight"</span>, <span class="st">"Num Gears"</span>, <span class="st">"Num Carbs"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">imp</span> <span class="op">&lt;-</span> <span class="fu">tornado</span><span class="fu">::</span><span class="fu"><a href="../reference/importance.html">importance</a></span><span class="op">(</span><span class="va">gtest</span>, <span class="va">gtestreduced</span>, dict <span class="op">=</span> <span class="va">dict</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">imp</span>, col_importance_alone <span class="op">=</span> <span class="st">"#8DD3C7"</span>, </span>
<span>     col_importance_cumulative <span class="op">=</span> <span class="st">"#FFFFB3"</span><span class="op">)</span></span></code></pre></div>
<p><img src="tornadoVignette_files/figure-html/imp.lm.dict-1.png" width="672"></p>
</div>
</div>
<div class="section level3">
<h3 id="generalized-linear-models">Generalized Linear Models<a class="anchor" aria-label="anchor" href="#generalized-linear-models"></a>
</h3>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gtest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">vs</span> <span class="op">~</span> <span class="va">wt</span> <span class="op">+</span> <span class="va">disp</span> <span class="op">+</span> <span class="va">gear</span>, data <span class="op">=</span> <span class="va">mtcars</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">gtestreduced</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">vs</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">mtcars</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">imp</span> <span class="op">&lt;-</span> <span class="fu">tornado</span><span class="fu">::</span><span class="fu"><a href="../reference/importance.html">importance</a></span><span class="op">(</span><span class="va">gtest</span>, <span class="va">gtestreduced</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">imp</span><span class="op">)</span></span></code></pre></div>
<p><img src="tornadoVignette_files/figure-html/imp.glm-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="censored-data-1">Censored Data<a class="anchor" aria-label="anchor" href="#censored-data-1"></a>
</h3>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_final</span> <span class="op">&lt;-</span> <span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/survreg.html" class="external-link">survreg</a></span><span class="op">(</span><span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">futime</span>, <span class="va">fustat</span><span class="op">)</span> <span class="op">~</span> <span class="va">ecog.ps</span><span class="op">*</span><span class="va">rx</span> <span class="op">+</span> <span class="va">age</span>,</span>
<span>                                 data <span class="op">=</span> <span class="fu">survival</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/survival/man/ovarian.html" class="external-link">ovarian</a></span>,</span>
<span>                                 dist <span class="op">=</span> <span class="st">"weibull"</span><span class="op">)</span></span>
<span><span class="va">imp</span> <span class="op">&lt;-</span> <span class="fu">tornado</span><span class="fu">::</span><span class="fu"><a href="../reference/importance.html">importance</a></span><span class="op">(</span><span class="va">model_final</span>, <span class="fu">survival</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/survival/man/ovarian.html" class="external-link">ovarian</a></span>, nperm <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">imp</span>, geom_bar_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.4</span>, fill <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="tornadoVignette_files/figure-html/imp_survreg-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="machine-learning">Machine Learning<a class="anchor" aria-label="anchor" href="#machine-learning"></a>
</h3>
<div class="section level4">
<h4 id="regression-1">Regression<a class="anchor" aria-label="anchor" href="#regression-1"></a>
</h4>
<p>The number of variables plotted can also be controlled</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"caret"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">&amp;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"randomForest"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">gtest</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">train</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">mtcars_w_factors</span>, select <span class="op">=</span> <span class="op">-</span><span class="va">mpg</span><span class="op">)</span>, </span>
<span>                        y <span class="op">=</span> <span class="va">mtcars_w_factors</span><span class="op">$</span><span class="va">mpg</span>, method <span class="op">=</span> <span class="st">"rf"</span><span class="op">)</span></span>
<span>  <span class="va">imp</span> <span class="op">&lt;-</span> <span class="fu">tornado</span><span class="fu">::</span><span class="fu"><a href="../reference/importance.html">importance</a></span><span class="op">(</span><span class="va">gtest</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">imp</span>, nvar <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span></span>
<span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"caret or randomForest is not available for vignette rendering"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="tornadoVignette_files/figure-html/train.regression.imp-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="classification-1">Classification<a class="anchor" aria-label="anchor" href="#classification-1"></a>
</h4>
<p>The <code>plot</code> method can also return a ggplot object</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"caret"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">&amp;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"randomForest"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">gtest</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">train</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">iris</span>, select <span class="op">=</span> <span class="op">-</span><span class="va">Species</span><span class="op">)</span>, </span>
<span>                        y <span class="op">=</span> <span class="va">iris</span><span class="op">$</span><span class="va">Species</span>, method <span class="op">=</span> <span class="st">"rf"</span><span class="op">)</span></span>
<span>  <span class="va">imp</span> <span class="op">&lt;-</span> <span class="fu">tornado</span><span class="fu">::</span><span class="fu"><a href="../reference/importance.html">importance</a></span><span class="op">(</span><span class="va">gtest</span><span class="op">)</span></span>
<span>  <span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">imp</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">g</span> <span class="op">&lt;-</span> <span class="va">g</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Classifier caret::train randomforest: variable importance"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span></span>
<span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"caret or randomForest is not available for vignette rendering"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="tornadoVignette_files/figure-html/train.classification.imp-1.png" width="672"></p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rob Carnell.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
